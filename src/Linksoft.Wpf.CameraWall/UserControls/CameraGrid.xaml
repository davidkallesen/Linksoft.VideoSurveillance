<UserControl
    x:Class="Linksoft.Wpf.CameraWall.UserControls.CameraGrid"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:atcTranslation="https://github.com/atc-net/atc-wpf/tree/main/schemas/translations"
    xmlns:valueConverters="clr-namespace:Linksoft.Wpf.CameraWall.ValueConverters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Linksoft.Wpf.CameraWall.UserControls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="480"
    d:DesignWidth="640"
    Background="#1E1E1E"
    mc:Ignorable="d">

    <Grid>
        <ItemsControl
            x:Name="CameraItemsControl"
            AllowDrop="True"
            Background="Transparent"
            ItemsSource="{Binding Path=CameraTiles, RelativeSource={RelativeSource AncestorType=UserControl}}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid x:Name="TileGrid" Rows="{Binding Path=GridRowCount, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <local:CameraTile
                        Margin="1"
                        AutoConnectOnLoad="{Binding Path=AutoConnectOnLoad, RelativeSource={RelativeSource AncestorType=local:CameraGrid}}"
                        Camera="{Binding}"
                        CameraDropped="OnCameraDropped"
                        ConnectionStateChanged="OnConnectionStateChanged"
                        DeleteCameraRequested="OnDeleteCameraRequested"
                        EditCameraRequested="OnEditCameraRequested"
                        FullScreenRequested="OnFullScreenRequested"
                        SnapshotPath="{Binding Path=SnapshotPath, RelativeSource={RelativeSource AncestorType=local:CameraGrid}}"
                        SwapLeftRequested="OnSwapLeftRequested"
                        SwapRightRequested="OnSwapRightRequested">
                        <!--  Per-camera overrides with fallback to app defaults  -->
                        <local:CameraTile.ShowOverlayTitle>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ShowOverlayTitle" />
                                <Binding Path="ShowOverlayTitle" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ShowOverlayTitle>
                        <local:CameraTile.ShowOverlayDescription>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ShowOverlayDescription" />
                                <Binding Path="ShowOverlayDescription" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ShowOverlayDescription>
                        <local:CameraTile.ShowOverlayTime>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ShowOverlayTime" />
                                <Binding Path="ShowOverlayTime" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ShowOverlayTime>
                        <local:CameraTile.ShowOverlayConnectionStatus>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ShowOverlayConnectionStatus" />
                                <Binding Path="ShowOverlayConnectionStatus" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ShowOverlayConnectionStatus>
                        <local:CameraTile.OverlayOpacity>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.OverlayOpacity" />
                                <Binding Path="OverlayOpacity" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.OverlayOpacity>
                        <!--  Connection settings with per-camera overrides  -->
                        <local:CameraTile.ConnectionTimeoutSeconds>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ConnectionTimeoutSeconds" />
                                <Binding Path="ConnectionTimeoutSeconds" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ConnectionTimeoutSeconds>
                        <local:CameraTile.ReconnectDelaySeconds>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ReconnectDelaySeconds" />
                                <Binding Path="ReconnectDelaySeconds" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ReconnectDelaySeconds>
                        <local:CameraTile.AutoReconnectOnFailure>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.AutoReconnectOnFailure" />
                                <Binding Path="AutoReconnectOnFailure" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.AutoReconnectOnFailure>
                        <!--  Notification settings with per-camera overrides  -->
                        <local:CameraTile.ShowNotificationOnDisconnect>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ShowNotificationOnDisconnect" />
                                <Binding Path="ShowNotificationOnDisconnect" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ShowNotificationOnDisconnect>
                        <local:CameraTile.ShowNotificationOnReconnect>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.ShowNotificationOnReconnect" />
                                <Binding Path="ShowNotificationOnReconnect" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.ShowNotificationOnReconnect>
                        <local:CameraTile.PlayNotificationSound>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.PlayNotificationSound" />
                                <Binding Path="PlayNotificationSound" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.PlayNotificationSound>
                        <!--  Performance settings with per-camera overrides  -->
                        <local:CameraTile.VideoQuality>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.VideoQuality" />
                                <Binding Path="VideoQuality" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.VideoQuality>
                        <local:CameraTile.HardwareAcceleration>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.HardwareAcceleration" />
                                <Binding Path="HardwareAcceleration" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.HardwareAcceleration>
                        <!--  Recording settings with per-camera overrides  -->
                        <local:CameraTile.EnableRecordingOnMotion>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.EnableRecordingOnMotion" />
                                <Binding Path="EnableRecordingOnMotion" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.EnableRecordingOnMotion>
                        <local:CameraTile.EnableRecordingOnConnect>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.EnableRecordingOnConnect" />
                                <Binding Path="EnableRecordingOnConnect" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.EnableRecordingOnConnect>
                        <!--  Motion detection settings with per-camera overrides  -->
                        <local:CameraTile.MotionSensitivity>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.MotionSensitivity" />
                                <Binding Path="MotionSensitivity" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.MotionSensitivity>
                        <local:CameraTile.MotionMinimumChangePercent>
                            <Binding Path="MotionMinimumChangePercent" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.MotionMinimumChangePercent>
                        <local:CameraTile.MotionAnalysisFrameRate>
                            <Binding Path="MotionAnalysisFrameRate" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.MotionAnalysisFrameRate>
                        <local:CameraTile.MotionPostDurationSeconds>
                            <MultiBinding Converter="{x:Static valueConverters:OverrideOrDefaultMultiValueConverter.Instance}">
                                <Binding Path="Overrides.PostMotionDurationSeconds" />
                                <Binding Path="MotionPostDurationSeconds" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                            </MultiBinding>
                        </local:CameraTile.MotionPostDurationSeconds>
                        <local:CameraTile.MotionCooldownSeconds>
                            <Binding Path="MotionCooldownSeconds" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.MotionCooldownSeconds>
                        <local:CameraTile.MotionBoundingBoxMinArea>
                            <Binding Path="MotionBoundingBoxMinArea" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.MotionBoundingBoxMinArea>
                        <local:CameraTile.MotionBoundingBoxPadding>
                            <Binding Path="MotionBoundingBoxPadding" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.MotionBoundingBoxPadding>
                        <!--  Bounding box display settings  -->
                        <local:CameraTile.ShowBoundingBoxInGrid>
                            <Binding Path="ShowBoundingBoxInGrid" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.ShowBoundingBoxInGrid>
                        <local:CameraTile.BoundingBoxColor>
                            <Binding Path="BoundingBoxColor" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.BoundingBoxColor>
                        <local:CameraTile.BoundingBoxThickness>
                            <Binding Path="BoundingBoxThickness" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.BoundingBoxThickness>
                        <local:CameraTile.BoundingBoxSmoothing>
                            <Binding Path="BoundingBoxSmoothing" RelativeSource="{RelativeSource AncestorType=local:CameraGrid}" />
                        </local:CameraTile.BoundingBoxSmoothing>
                    </local:CameraTile>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!--  Empty State Message  -->
        <TextBlock
            x:Name="EmptyStateText"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            FontSize="16"
            Foreground="#888888"
            Text="{atcTranslation:Resx ResxName=Linksoft.Wpf.CameraWall.Resources.Translations,
                                       Key=NoCamerasConfigured}"
            Visibility="Collapsed" />
    </Grid>
</UserControl>
